// Generated by CoffeeScript 1.6.3
(function() {
  define([], function() {
    return [
      '$scope', '$resource', '$http', '$routeParams', '$window', 'Msg', function($scope, $resource, $http, $routeParams, $window, Msg) {
        var Fields, actions, getFormField, table_id, _form_field;
        table_id = $routeParams.id;
        if (!table_id) {
          $window.location.href = '#/content/table';
        }
        actions = {
          save: {
            method: 'POST'
          },
          update: {
            method: 'PUT'
          },
          mulit: {
            method: 'GET',
            params: {
              id: table_id
            }
          }
        };
        Fields = $resource("/api/tablefield", {}, actions);
        $scope.isList = true;
        $scope.fields = Fields.mulit();
        $scope.change = function(v) {
          return Fields.update(v);
        };
        _form_field = [];
        getFormField = function(callback) {
          return $http.get('/api/get.form', {
            params: {
              form: 'app.forms.cms.TableField'
            }
          }).success(function(data) {
            _form_field = data.form;
            $scope.form = angular.copy(_form_field);
            if (angular.isFunction(callback)) {
              return callback();
            }
          });
        };
        getFormField();
        $scope.submit = function() {
          var postData;
          postData = {};
          angular.forEach($scope.form, function(field) {
            return postData[field.name] = field.data;
          });
          postData.table_id = table_id;
          console.log(postData);
          $scope.isList = true;
          return Fields.save(postData, function(ret) {
            return $scope.fields = Fields.mulit();
          });
        };
        return $scope.add = function() {
          $scope.isList = false;
          $scope.form = angular.copy(_form_field);
          return angular.forEach($scope.form, function(field) {
            if (field.name === 'table_id') {
              field.data = table_id;
              return false;
            }
          });
        };
      }
    ];
  });

}).call(this);
